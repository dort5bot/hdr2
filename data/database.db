CREATE TABLE mails (
    message_id TEXT PRIMARY KEY,
    from_email TEXT NOT NULL,
    file_path TEXT NOT NULL,
    status TEXT NOT NULL CHECK(status IN ('pending', 'processing', 'success', 'failed')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    processed_at TIMESTAMP NULL,
    error_message TEXT NULL
);



CREATE INDEX idx_mails_status ON mails(status);
CREATE INDEX idx_mails_created_at ON mails(created_at);

CREATE TABLE logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    level TEXT NOT NULL CHECK(level IN ('DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL')),
    message TEXT NOT NULL,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    module TEXT NULL,
    context TEXT NULL
);

CREATE INDEX idx_logs_timestamp ON logs(timestamp);
CREATE INDEX idx_logs_level ON logs(level);


CREATE TABLE processed_files (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    original_filename TEXT NOT NULL,
    processed_filename TEXT NOT NULL,
    group_no TEXT NOT NULL,
    file_size INTEGER NOT NULL,
    row_count INTEGER NOT NULL,
    processed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status TEXT NOT NULL CHECK(status IN ('success', 'failed')),
    error_message TEXT NULL
);

CREATE INDEX idx_processed_files_group ON processed_files(group_no);
CREATE INDEX idx_processed_files_date ON processed_files(processed_at);


CREATE TABLE email_stats (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    date DATE NOT NULL,
    total_emails INTEGER DEFAULT 0,
    processed_emails INTEGER DEFAULT 0,
    failed_emails INTEGER DEFAULT 0,
    total_files INTEGER DEFAULT 0,
    UNIQUE(date)
);


